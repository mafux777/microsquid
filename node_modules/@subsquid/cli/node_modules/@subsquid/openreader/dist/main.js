"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const pg_1 = require("pg");
const db_1 = require("./db");
const server_1 = require("./server");
const tools_1 = require("./tools");
module.exports = function main() {
    let args = process.argv.slice(2);
    if (args.indexOf('--help') >= 0) {
        help();
        process.exit(1);
    }
    if (args.length != 1) {
        help();
        process.exit(1);
    }
    let model = (0, tools_1.loadModel)(args[0]);
    let db = new pg_1.Pool((0, db_1.createPoolConfig)());
    let port = process.env.GRAPHQL_SERVER_PORT || 3000;
    (0, server_1.serve)({ model, db, port }).then(() => {
        console.log('OpenReader is listening on port ' + port);
    }, err => {
        console.error(err);
        process.exit(1);
    });
};
function help() {
    console.error(`
Usage:  openreader SCHEMA

OpenCRUD GraphQL server.

Can be configured using the following environment variables:

    DB_NAME
    DB_USER
    DB_PASS
    DB_HOST
    DB_PORT
    GRAPHQL_SERVER_PORT
`);
}
//# sourceMappingURL=main.js.map