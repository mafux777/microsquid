"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const core_1 = require("@oclif/core");
const typeorm_config_1 = require("@subsquid/typeorm-config");
const util_1 = require("@subsquid/util");
class NewMigration extends core_1.Command {
    async run() {
        let { args } = await this.parse(NewMigration);
        let name = args.name ? args.name : await core_1.CliUx.ux.prompt('Enter migration name', {
            required: true,
        });
        let cfg = (0, typeorm_config_1.createOrmConfig)();
        let dir = new util_1.OutDir((0, util_1.assertNotNull)(cfg.cli?.migrationsDir));
        let timestamp = Date.now();
        let out = dir.file(`${timestamp}-${name}.js`);
        out.block(`module.exports = class ${name}${timestamp}`, () => {
            out.line(`name = '${name}${timestamp}'`);
            out.line();
            out.block(`async up(db)`, () => {
                out.line();
            });
            out.line();
            out.block(`async down(db)`, () => {
                out.line();
            });
        });
        out.write();
    }
}
exports.default = NewMigration;
NewMigration.description = 'Create template file for a new migration';
NewMigration.args = [{ name: 'name' }];
//# sourceMappingURL=new-migration.js.map